<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../Css/servidor.css">
    <title>Document</title>
    <style>
        body{
            background-color: rgb(241, 241, 241);
            
        }
        #conteudovelha{
        height: 100vh;
        display: flex;
        justify-content: center;
    }
        main {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: white;
            width: 70%;
            border-radius: 5%;
            box-shadow: -10px 10px 15px rgb(221, 221, 221);        
        }
        #section1{
            display: flex;
            flex-direction: row;;
            gap: 200px;

        }
        #meio{
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: -250px;
            
        }
        #esquerda{
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        #container-velha{
            display: grid;
            gap: 5px;
            grid-template-rows: repeat(3, 120px);
            grid-template-columns: repeat(3, 120px);
            width: 370px;
            margin-top: 40px
        }
        #titulo{
            display: flex;
            width: 100%;
            align-items: center;
            justify-items: center;
        }
        
        .nivel-container{
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 20px;
        }
        .celulas{
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 4em;
            background-color: black;
            border: 3px solid var(--CorPrincipal);
            color: var(--CorPrincipal);
            transition: 0.3s ease;
            cursor: pointer;
            box-shadow: -10px 10px 15px rgb(221, 221, 221);
            

        }
        .celulas:hover{
            transform: scale(1.1);
            box-shadow: 0px 0px 15px var(--CorPrincipal);
        }

        .celulas:active{
            transform: scale(0.95);
        }
        .celulas-vencedora{
            background-color: var(--CorPrincipal);
            color: white;
            transform: scale(1.05);
            box-shadow: 0px 0px 15px var(--CorPrincipal);
            border: dashed black 2px;
            animation: pulse 1s infinite alternate ;
        }
        .celulas-empate{
            background-color: grey;
            cursor: not-allowed;
        }
        .celulas.celulas-empate:hover {
            transform: none;
            cursor: not-allowed;
            box-shadow: -10px 10px 15px rgb(221, 221, 221);
        }
        .buttonfeito{
            background-color: black;
            padding: 10px;
            font-size: 14pt;
            color: var(--CorPrincipal);
            border: 2px solid var(--CorPrincipal);
            box-shadow: -5px 5px 10px rgb(221, 221, 221);
            transition: 0.3s ease;
        }
        .buttonfeito:hover{
            transform: scale(1.05);
            background-color: var(--CorPrincipal);
            cursor: pointer;
            color: black;
            border: 2px solid var(--CorPrincipal);
            box-shadow: 0px 0px 15px var(--CorPrincipal);
        }
        .buttonfeito:active{
            transform: scale(0.95);
            background-color: var(--CorPrincipalEscuro);
            color: white;
        }
        .btnbot{
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }
        .btnbot p{
            margin-bottom: 6px;
            font-weight: bold;
            color: black;
        }
        .slider::before{
            content: "";
            background-color: var(--CorPrincipal);
            height: 20px;
            width: 20px;;
            left: 4px;
            top:4px;
            border-radius: 50%;
            position: absolute;
            transition: 0.3s ease;
            border: black solid 1px;
        }

        input:checked + .slider{
            background-color: var(--CorPrincipal);
            box-shadow: 0px 0px 10px var(--CorPrincipal);
        }

        input:checked + .slider::before {
         transform: translateX(26px);
        }
        
        .btnbot input{
            position: absolute;
            width: 0;
            height: 0;
            opacity: 0;
            
        }

        .slider{
            border: solid 1px black;
            position: relative;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            background-color: #ccc;
            border-radius: 34px;
            cursor: pointer;
            width: 60px;
            height: 30px;
        }
        #placar{
            display: flex;
            padding: 15px 5px 5px 25px;
            flex-direction: column;
            background-color: black;
            border: 3px solid var(--CorPrincipal);
            color: var(--CorPrincipal);
            width: 300px;
            height: 300px;
            box-shadow: -10px 10px 15px rgb(221, 221, 221);
        }
        #meio h2{
            margin: 0px auto;
        }
        #placar h1{
            margin: 0px auto;
            margin-bottom: 10px;
        }

        #container-placar{
            display: flex;
            flex-direction: row;
            margin-top: 15px;
        }
        #player1{
            border-right: 2px solid var(--CorPrincipal);
            padding-right: 15px;
        }
        #player2{
            padding-left: 15px;
        }
        input[name="nivel"]:disabled + .slider{
            opacity: 0.5;
            cursor: not-allowed;
        }
        @keyframes pulse {
  from { transform: scale(1.05); border: dashed 2px black; }
  to   { transform: scale(1.10); border: dashed 2px white;}
}

    </style>
</head>
<body>
<div id="sidebar-container"></div>
<div id="overlay"></div>
<div id="header-container"></div>
<div id="conteudovelha">
    <main>
        <section id="section1">

            <div id="esquerda">
                <button id="comecar" class="buttonfeito" style="font-size: 18pt;">Começar</button>
                <button id="reset" class="buttonfeito" style="display: none;">Resetar</button>
                <button id="fim" class="buttonfeito"style="display: none;">Fim</button>
            </div>


            <div id="meio">
                <div id="titulo"><h2>Escolha o nivel do BOT</h2></div>

                <div class="nivel-container">
                    <label class="btnbot"><p>Off</p><input type="radio" value="0" name="nivel"><span class="slider"></span></label>
                    <label class="btnbot"><p>Nivel 1</p><input type="radio" value="1" name="nivel" ><span class="slider"></span></label>
                    <label class="btnbot"><p>Nivel 2</p><input type="radio" value="2" name="nivel"><span class="slider"></span></label>
                    <label class="btnbot"><p>Nivel 3</p><input type="radio" value="3" name="nivel"><span class="slider"></span></label>
                </div>

                <div id="container-velha">
                    <div class="celulas" id="celulas-0"></div>
                    <div class="celulas" id="celulas-1"></div>
                    <div class="celulas" id="celulas-2"></div>
                    <div class="celulas" id="celulas-3"></div>
                    <div class="celulas" id="celulas-4"></div>
                    <div class="celulas" id="celulas-5"></div>
                    <div class="celulas" id="celulas-6"></div>
                    <div class="celulas" id="celulas-7"></div>
                    <div class="celulas" id="celulas-8"></div>
                </div>

            </div>


            <div id="direita">
                <div id="placar" style="display: none;">
                    <h1>Placar</h1> 
                    <p id="partidas">Partidas jogadas: 0</p >
                    <p id="empates">Empates</p>
                    <div id="container-placar">

                        <div class="player" id="player1"> <h2>Player X</h2><p id="vitoriasX">Vitórias: 0</p><p id="perdasX">Perdas: 0</p></div>
                        <div class="player" id="player2"> <h2>Player O</h2><p id="vitoriasO">Vitórias: 0</p><p id="perdasO">Perdas: 0</p></div>

                    </div>
                </div>
            </div>


        </section>
    </main>
</div>


<div id="footer-container"></div>


<script type="module" src="../../Javascript/conjunto.js"></script>
<script type="module" src="jogodavelha.js"></script>
<script>
    window.addEventListener("load", () => {
        celulas.forEach((celula) => {celula.classList.add("celulas-empate")})
    })

    

    const celulas = document.querySelectorAll(".celulas");
    let playerAtual = "X";
    let fim = true;
    let jogadasplayerO = [];
    let jogadasplayerX = [];
    let nivel1 = false
    let nivel2 = false;
    let nivel3 = false;
    let empates = 0;
    let vitoriaX = 0
    let vitoriaO = 0
    let partidas = 0

    const opostos = {
        0:8,
        8:0,
        2:6,
        6:2
    }
    const defesalado = {
        1:[0,2,4,7],
        3: [0,4,5,6],
        5: [2,4,3,8],
        7: [6,8,4,1]
    }

    const trocarJogador = function(){
        playerAtual = (playerAtual === "X") ? "O" : "X";
    }
    const reset = document.getElementById("reset");
    reset.addEventListener("click", ()=>{
        celulas.forEach((celula) => {
            celula.textContent = "";
            celula.classList.remove("celulas-vencedora");
            celula.classList.remove("celulas-empate")
            
        })
        playerAtual = "X"
    jogadasplayerO = [];
    jogadasplayerX = [];
    fim = false;
    })

   const atualizarPlacar = function() {
  document.getElementById("partidas").textContent = `Partidas jogadas: ${partidas}`;
  document.getElementById("empates").textContent   = `Empates: ${empates}`;
  document.getElementById("vitoriasX").textContent = `Vitórias: ${vitoriaX}`;
  document.getElementById("perdasX").textContent   = `Perdas: ${vitoriaO}`; // perda de X = vitória de O
  document.getElementById("vitoriasO").textContent = `Vitórias: ${vitoriaO}`;
  document.getElementById("perdasO").textContent   = `Perdas: ${vitoriaX}`; // perda de O = vitória de X
}


    celulas.forEach((celula) =>{
        celula.addEventListener("click", () => {
           if(fim === false && celula.textContent === ""){
                celula.textContent = playerAtual
                console.log(`nivel1: ${nivel1}, nivel 2: ${nivel2}, nivel 3: ${nivel3}`);
                if(playerAtual === "X"){
                    let index = [...celulas].indexOf(celula);
                    jogadasplayerX.push(index);
                }

                if(playerAtual === "O"){
                    let index = [...celulas].indexOf(celula);
                    jogadasplayerO.push(index);
                }

                console.log(`o player x tem ${jogadasplayerX}     o player o tem ${jogadasplayerO} celulas lenght = ${[...celulas].filter((celula) => { return celula.textContent !== ""}).length}`)
                
                let vencedor = verificarVencedor();
                
                let cheio = [...celulas].every(celula => celula.textContent !== "");;

                if(cheio){
                    fim = true;
                    alert("fim do jogo, empate!");
                    celulas.forEach((celula) => {celula.classList.add("celulas-empate")})
                    partidas += 1;
                    empates += 1;
                    atualizarPlacar();
                };
                
                if(vencedor){
                    alert(`O vencedor foi o jogador ${vencedor}! `);
                    fim = true;
                    partidas += 1;
                    if(playerAtual === "X"){
                        vitoriaX += 1;
                        atualizarPlacar()
                    }
                    else {
                        vitoriaO += 1;
                        atualizarPlacar()
                    }
                };
                
                trocarJogador();

                
                if (playerAtual === "O"){
                    setTimeout(() => {
                        fim = false
                        bot();}, 300);
                };
                
            };
        });
    })






    const clickaleatorio = function(){
        let celulasvazias = [...celulas].filter((celula) => celula.textContent === "")
        let celulaaleatoriavazia = celulasvazias[Math.floor(Math.random() * celulasvazias.length)]
        celulaaleatoriavazia.click();
    }

    const bot = function(){
        if (nivel1){
            clickaleatorio();
        }
        else if(nivel2){
            if(verificarfaltaum("O") !== undefined){
                ataquefaltaum();
                console.log("entrou no ataque");
            }
            else if(verificarfaltaum("X") !== undefined){
                defesafaltaum();
                console.log("entrou na defesa");
            }
            else{
                clickaleatorio();
                console.log("entrou no click aleatorio");
            }
            console.log("saiu de tudo")
        }
        else if(nivel3){

            if ([0,2,6,8].includes(jogadasplayerX[0]) && [...celulas].filter((celula) => { return celula.textContent !== ""}).length === 1){
                celulas[4].click();
                console.log("Atacou canto");
            }
            else if(opostos[jogadasplayerX[0]] === jogadasplayerX[1] && jogadasplayerX.length === 2){
                let ladosvazios = [1,3,5,7].filter(indice => celulas[indice].textContent === "");
                celulas[ladosvazios[Math.floor(Math.random() * ladosvazios.length)]].click();

                console.log("2° jogada, jogar no lado")
            }

            else if(jogadasplayerX.length === 1 && jogadasplayerX[0] in defesalado){
                let indiceVazio = defesalado[jogadasplayerX[0]].filter((ind) => { return celulas[ind].textContent === ""});
                celulas[indiceVazio[Math.floor(Math.random() * indiceVazio.length)]].click();
                console.log("O bot defendeu estrategia iniciada pelos lado");
            }
            else if(jogadasplayerX.length === 1 && jogadasplayerX[0] === 4){
                const cantos = [0, 2, 6, 8];
                celulas[cantos[Math.floor(Math.random()*cantos.length)]].click();
            }
            else if(verificarfaltaum("O") !== undefined){
                ataquefaltaum();
                console.log("entrou no ataque");
            }
            else if(verificarfaltaum("X") !== undefined){
                defesafaltaum();
                console.log("entrou na defesa");
            }
            else{
                clickaleatorio();
                console.log("entrou no click aleatorio");
            }                                                                           
            console.log("saiu de tudo")
        }
    }

    const combinacoesVitoria = [
        [0,1,2], [3,4,5], [6,7,8],
        [0,3,6], [1,4,7], [2,5,8],
        [0,4,8], [2,4,6]
    ]

    const verificarVencedor = function(){
        for( let combinacao of combinacoesVitoria){
            let [a,b,c] = combinacao;
            if( 
                celulas[a].textContent !== "" &&
                celulas[b].textContent === celulas[a].textContent && 
                celulas[c].textContent === celulas[b].textContent){

                    // let cor = getComputedStyle(document.documentElement).getPropertyValue("--CorPrincipal").trim();
                   
                    [a,b,c].forEach((indiceselecionado) => {
                        celulas[indiceselecionado].classList.add("celulas-vencedora");
                    })
                    return celulas[a].textContent;
                }
        }
        return undefined;
    }

    const verificarfaltaum = function(XouO){
        for( let combinacao of combinacoesVitoria){
            let [a,b,c] = combinacao;
            const [celA, celB, celC] = combinacao.map(indice => celulas[indice].textContent);
            const valores = [celA, celB, celC];
            const indices = [a,b,c];
            
            if (valores.filter(valor => valor === XouO).length === 2 && valores.includes("")){
                const indiceVazio = valores.indexOf("");
                return indices[indiceVazio];
            }
        }
        return undefined
    }

    const defesafaltaum = function(){
       celulas[verificarfaltaum("X")].click()
    }
    const ataquefaltaum = function(){
       celulas[verificarfaltaum("O")].click()
    }
    const inputs = document.querySelectorAll('input[name="nivel"]')
    const comecar = document.getElementById("comecar");
    const zerar = document.getElementById("fim")
    const placar = document.getElementById("placar")
    
    comecar.addEventListener("click", () => {
        const selecionado = document.querySelector('input[name="nivel"]:checked');
        if(!selecionado){
            alert("Escolha o nivel do bot, ou desligue-o!")
        }

        else{
            inputs.forEach((inp) => {
                inp.disabled = true;
            })
            celulas.forEach((celula) => { celula.classList.remove("celulas-empate")});
            reset.style.display = "block";
            zerar.style.display = "block";
            comecar.style.display = "none";
            placar.style.display = "block"
            fim = false;

            
            switch(selecionado.value){
                case "0":
                    nivel1 =false;
                    nivel2 = false;
                    nivel3 = false;
                    break

                case "1":
                    nivel1 = true;
                    nivel2 = false;
                    nivel3 = false;
                    break
                
                case "2":
                    nivel1 =false;
                    nivel2 = true;
                    nivel3 = false;
                    break
                
                case "3":
                    nivel1 =false;
                    nivel2 = false;
                    nivel3 = true;
                    break
        
            }
        }
 })
        

    zerar.addEventListener("click", ()=>{
    celulas.forEach((celula) => {
        celula.textContent = "";
        celula.classList.remove("celulas-vencedora");
        celula.classList.add("celulas-empate")
        
    })
        inputs.forEach((inp) => {
        inp.disabled = false;
    })

    reset.style.display = "none";
    zerar.style.display = "none";
    comecar.style.display = "block";
    placar.style.display = "none"
    fim = true;
    playerAtual = "X"
    jogadasplayerO = [];
    jogadasplayerX = [];

})


</script>
</body>
</html>